<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Assign Schedule</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    body {
      background-color: #121212;
      font-family: 'Inter', sans-serif;
      color: #e0e0e0;
    }
    h1 {
      color: #ff7e29;
      text-align: center;
      margin: 2rem 0;
    }
    table {
      background: #1e1e1e;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
    thead {
      background: #ff7e29;
      color: #1a1a1a;
      font-weight: bold;
    }
    td, th {
      vertical-align: middle;
    }
    select {
      background: #1a1a1a;
      color: #e0e0e0;
      border: 1px solid #ff7e29;
      border-radius: 6px;
      padding: 5px;
    }
    button {
      background: #ff7e29;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: #ff9e4d;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Assign Schedule</h1>
<p>wk35</p>
  <div class="table-responsive">
    <table class="table table-dark table-striped align-middle">
      <thead>
        <tr>
          <th>Name</th>
          <th>Schedule</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="assignTable">
        <!-- Rows will be generated dynamically -->
      </tbody>
    </table>
  </div>
  <div id="status" class="text-center fw-bold mt-3"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAwzp3h8tt_tcDF1um--LoroAu1rErMmBc",
    authDomain: "virac-tsv.firebaseapp.com",
    projectId: "virac-tsv",
    storageBucket: "virac-tsv.appspot.com",
    messagingSenderId: "455316064834",
    appId: "1:455316064834:web:1dc1033265b58a6c82bbdb"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const names = [
    "MARK ANDREW ERISARE","ALLAN HARLEM KRYSLER CADABA","ANDREA ESTRELLADO","ANGEL MAE VALENZUELA",
    "ANJENETTE MANALO","AVEENA MARIE BAUSIN","CRISTINE ANGELA ICARO","EDGAR PANTI II",
    "FIONA MAGDARAOG","FRANCIS MAGDAONG","GENEVA VARGAS","JHESTER OGALESCO","KATHLYN TATING",
    "KEITH MANUEL ESPARAS","RENZO MANUEL ESPARAS","MEDELIZA OLINO","MICAH FERNANDEZ",
    "ROI VINCENT TUGAY","RONNIE BERINO","ROGER TUGAY","SHAELLA O. OGALESCO",
    "SHIRRA MAE FERNANDEZ","VENDRED EVANGELISTA"
  ];

  const schedules = [
    {label:"Wednesday 6:00 AM", value:"2025-08-27T06:00:00"},
    {label:"Thursday 6:00 AM", value:"2025-08-28T06:00:00"},
    {label:"Thursday 7:00 PM", value:"2025-08-28T19:00:00"},
    {label:"Saturday 6:00 AM", value:"2025-08-30T06:00:00"},
    {label:"Sunday 6:00 AM", value:"2025-08-31T06:00:00"},
    {label:"Sunday 10:00 AM", value:"2025-08-31T10:00:00"},
    {label:"PNK Sunday 8:00 AM", value:"2025-08-31T08:00:00"},
    {label:"Pamamahayag 7:00 PM", value:"2025-08-29T19:00:00"}
  ];

  const tableBody = document.getElementById("assignTable");
  const statusDiv = document.getElementById("status");

  // Generate rows
  names.forEach(name => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${name}</td>
      <td>
        <select class="form-select schedule-select">
          <option value="">-- Select --</option>
          ${schedules.map(s => `<option value="${s.value}">${s.label}</option>`).join('')}
        </select>
      </td>
      <td><button class="assignBtn btn-sm">Assign</button></td>
    `;
    tableBody.appendChild(tr);

    const button = tr.querySelector(".assignBtn");
    const select = tr.querySelector(".schedule-select");

    button.addEventListener("click", async () => {
      const datetime = select.value;
      if (!datetime) {
        statusDiv.textContent = "⚠ Please select a schedule for " + name;
        statusDiv.style.color = "orange";
        return;
      }

      try {
        await setDoc(doc(db, 'wk35', name), {
          assignedTime: datetime
        }, { merge: true });

        const displayTime = new Date(datetime).toLocaleString();
        statusDiv.textContent = `✅ Assigned ${name} to ${displayTime}`;
        statusDiv.style.color = "lightgreen";
      } catch (error) {
        statusDiv.textContent = `❌ Error: ${error.message}`;
        statusDiv.style.color = "red";
      }
    });
  });
</script>

</body>
</html>
